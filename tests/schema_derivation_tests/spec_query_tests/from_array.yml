catalog_schema:
  {
    'test': {
      'foo': {
        'bsonType': 'object',
        'additionalProperties': true,
      }
    }
  }

tests:
  - description: basic array datasource correctness test
    query: "SELECT * FROM [{'a': 1, 'b': 1}] AS arr"
    current_db: test
    result:
      - {'arr': {'a': 1, 'b': 1}}

  - description: unqualified reference to field from array datasource
    query: "SELECT VALUE {'a': a} FROM [{'a': 1, 'b': 1}] AS arr"
    current_db: test
    result:
      - {'': {'a': 1}}

  - description: qualified reference to field from array datasource
    query: "SELECT VALUE {'a': arr.a} FROM [{'a': 1, 'b': 1}] AS arr"
    current_db: test
    result:
      - {'': {'a': 1}}

  - description: empty array datasource is allowed
    query: "SELECT * FROM [] AS arr"
    current_db: test
    result: []

  - description: array datasource with single empty document is allowed
    query: "SELECT * FROM [{}] AS _dual"
    current_db: test
    result:
      - {'_dual': {}}
