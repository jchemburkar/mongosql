%YAML 1.2
---
catalog_schema: {foo: {bar: {bsonType: object, required: [d, i], additionalProperties: false,
      properties: {d: {bsonType: double}, i: {bsonType: int}}}}}

tests:
  - description: SELECT empty array literal
    query: "SELECT VALUE {'_1': []} FROM [{}] AS _dual"
    current_db: test
    result_set_schema:
      bsonType: object
      properties:
        '':
          bsonType: object
          properties:
            _1:
              bsonType: array
          required: [_1]
          additionalProperties: false
      required: ['']
      additionalProperties: false
  
  - description: SELECT non-empty array literal
    query: "SELECT VALUE {'_1': [1, true, 'yes', {'a': 'b'}, [1.0, false]]} FROM [{}] AS _dual"
    current_db: test
    result_set_schema:
      bsonType: object
      properties:
        '':
          bsonType: object
          properties:
            _1:
              bsonType: array
              items:
                anyOf:
                - {bsonType: int}
                - {bsonType: string}
                - {bsonType: bool}
                - bsonType: array
                  items:
                    anyOf:
                    - {bsonType: double}
                    - {bsonType: bool}
                - bsonType: object
                  properties:
                    a: {bsonType: string}
                  required: [a]
                  additionalProperties: false
          required: [_1]
          additionalProperties: false
        _id: {bsonType: objectId}
      required: ['', _id]
      additionalProperties: false
