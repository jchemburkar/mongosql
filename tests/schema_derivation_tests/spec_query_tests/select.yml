catalog_schema:
  {
    'mydb': {
      'foo': {
        'bsonType': 'object',
        'additionalProperties': true,
      }
    }
  }

tests:
  - description: star cannot be used in SELECT VALUE
    current_db: mydb
    query: "SELECT VALUE * FROM foo AS f"
    should_compile: false
    parse_error: "Unrecognized token `*`"

  - description: star is not an ordinary expression
    current_db: mydb
    query: "SELECT VALUE {'a': *} FROM foo AS f"
    should_compile: false
    parse_error: "Unrecognized token `*`"

  - description: substar is not an ordinary expression
    current_db: mydb
    query: "SELECT VALUE {'a': foo.*} FROM foo AS foo"
    should_compile: false
    parse_error: "Unrecognized token `.*`"

  - description: aliases disallowed for substar expressions in SELECT VALUE
    current_db: mydb
    query: "SELECT VALUE t.* AS a FROM foo AS f"
    should_compile: false
    parse_error: "Unrecognized token `AS`"

  - description: aliases disallowed for substar expressions in standard SELECT
    current_db: mydb
    query: "SELECT t.* AS a FROM foo AS f"
    should_compile: false
    parse_error: "Unrecognized token `AS`"

  - description: aliases disallowed for document expressions in SELECT VALUE
    current_db: mydb
    query: "SELECT VALUE {'a': 1} AS a FROM foo AS f"
    should_compile: false
    parse_error: Unrecognized token `AS`

  - description: simple star correctness test
    current_db: mydb
    query: "SELECT * FROM foo AS f"
    result:
     - {'f': {'_id': 0, 'a': 1, 'b': 1}}
     - {'f': {'_id': 1, 'a': 2, 'b': 2}}

  - description: simple document correctness test
    current_db: mydb
    query: "SELECT VALUE {'a': a, 'b': b} FROM foo AS foo"
    result:
      - {'': {'a': 1, 'b': 1}}
      - {'': {'a': 2, 'b': 2}}

  - description: simple sub-star correctness test
    current_db: mydb
    query: "SELECT VALUE f.* FROM foo AS f"
    result:
     - {'f': {'_id': 0, 'a': 1, 'b': 1}}
     - {'f': {'_id': 1, 'a': 2, 'b': 2}}

  - description: correctness test for mixed sub-star and document
    current_db: mydb
    query: "SELECT VALUES {'a': foo.a}, foo.* FROM foo AS foo"
    result:
      - {'foo': {'_id': 0, 'a': 1, 'b': 1}, '': {'a': 1}}
      - {'foo': {'_id': 1, 'a': 2, 'b': 2}, '': {'a': 2}}

  - description: SELECT VALUES may create unmaterializable binding tuples
    current_db: mydb
    query: "SELECT VALUES {'a': a.a}, a.* FROM foo AS a"
    result:
      - {'a': {'_id': 0, 'a': 1, 'b': 1}, '': {'a': 1}}
      - {'a': {'_id': 1, 'a': 2, 'b': 2}, '': {'a': 2}}
